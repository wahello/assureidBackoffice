{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/mongo","imported":["Mongo"],"specifiers":[{"kind":"named","imported":"Mongo","local":"Mongo"}]},{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]}],"exports":{"exported":["TicketMaster"],"specifiers":[{"kind":"local","local":"TicketMaster","exported":"TicketMaster"}]}}},"options":{"filename":"imports/website/ServiceProcess/api/TicketMaster.js","filenameRelative":"imports/website/ServiceProcess/api/TicketMaster.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/website/ServiceProcess/api/TicketMaster.js.map","sourceFileName":"imports/website/ServiceProcess/api/TicketMaster.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"TicketMaster"},"ignored":false,"code":"module.export({\n\tTicketMaster: function () {\n\t\treturn TicketMaster;\n\t}\n});\nvar Mongo = void 0;\nmodule.watch(require(\"meteor/mongo\"), {\n\tMongo: function (v) {\n\t\tMongo = v;\n\t}\n}, 0);\nvar Meteor = void 0;\nmodule.watch(require(\"meteor/meteor\"), {\n\tMeteor: function (v) {\n\t\tMeteor = v;\n\t}\n}, 1);\nvar TicketMaster = new Mongo.Collection(\"ticketMaster\");\n\nif (Meteor.isServer) {\n\tMeteor.publish('allTickets', function () {\n\t\treturn TicketMaster.find({});\n\t});\n\tMeteor.publish('singleTicket', function (_id) {\n\t\treturn TicketMaster.find({\n\t\t\t\"_id\": _id\n\t\t});\n\t});\n\tMeteor.methods({\n\t\t'createTicket': function (id, userId, serviceId, serviceName, totalAmount, paymentStatus, delieveryStatus) {\n\t\t\tvar ticketObj = TicketMaster.findOne({}, {\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: -1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (ticketObj) {\n\t\t\t\t// var ticketNumber = parseInt(ticketObj.ticketNumber.);\n\t\t\t\t//  var last  = parseInt(ticketObj.ticketNumber.substr(ticketObj.ticketNumber.length - 6));\n\t\t\t\t//  var first = ticketObj.ticketNumber.substr(0, 1);\n\t\t\t\t// var ticket = 'AZ099998';\n\t\t\t\tvar first = ticketObj.ticketNumber.substr(0, 2);\n\t\t\t\tvar last = parseInt(ticketObj.ticketNumber.substr(ticketObj.ticketNumber.length - 6));\n\t\t\t\tlast = last + 1;\n\t\t\t\tvar last0 = '0';\n\n\t\t\t\tif (last > 0 && last < 11) {\n\t\t\t\t\tlast0 = '00000' + last;\n\n\t\t\t\t\tif (last == 10) {\n\t\t\t\t\t\tlast0 = '0000' + last;\n\t\t\t\t\t} /*working*/\n\t\t\t\t} else if (last > 10 && last < 101) {\n\t\t\t\t\tlast0 = '0000' + last;\n\n\t\t\t\t\tif (last == 100) {\n\t\t\t\t\t\tlast0 = '000' + last;\n\t\t\t\t\t} /*working*/\n\t\t\t\t} else if (last > 100 && last < 1001) {\n\t\t\t\t\tlast0 = '000' + last;\n\n\t\t\t\t\tif (last == 1000) {\n\t\t\t\t\t\tlast0 = '00' + last;\n\t\t\t\t\t} /*working*/\n\t\t\t\t} else if (last > 1000 && last < 10001) {\n\t\t\t\t\tlast0 = '00' + last;\n\n\t\t\t\t\tif (last == 10000) {\n\t\t\t\t\t\tlast0 = '0' + last;\n\t\t\t\t\t} /*working*/\n\t\t\t\t} else if (last > 10000 && last < 100001) {\n\t\t\t\t\tlast0 = '0' + last;\n\n\t\t\t\t\tif (last == 100000) {\n\t\t\t\t\t\tlast0 = '000000';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (last >= 100000) {\n\t\t\t\t\tlast0 = '000000';\n\t\t\t\t\tvar first2Char = first.substr(1, 1); /*second digit*/\n\t\t\t\t\tvar secondAscii = first2Char.charCodeAt(); /*second ascii*/\n\t\t\t\t\tvar firstChar = first.substr(0, 1); /*First char*/\n\n\t\t\t\t\tif (secondAscii == 90) {\n\t\t\t\t\t\tvar firstAscii = firstChar.charCodeAt() + 1;\n\t\t\t\t\t\tfirst = String.fromCharCode(firstAscii) + 'A';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar newsecond = secondAscii + 1;\n\t\t\t\t\t\tfirst = firstChar + '' + String.fromCharCode(newsecond);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar ticketNumber = first + '' + last0;\n\t\t\t} else {\n\t\t\t\tvar ticketNumber = 'AA000000';\n\t\t\t}\n\n\t\t\tvar ticketId = TicketMaster.insert({\n\t\t\t\t\"orderId\": id,\n\t\t\t\t\"userId\": userId,\n\t\t\t\t\"serviceId\": serviceId,\n\t\t\t\t\"serviceName\": serviceName,\n\t\t\t\t\"payment\": totalAmount,\n\t\t\t\t\"paymentStatus\": paymentStatus,\n\t\t\t\t\"ticketNumber\": ticketNumber,\n\t\t\t\t\"ticketStatus\": [delieveryStatus],\n\t\t\t\t\"createdAt\": new Date()\n\t\t\t}, function (error, result) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn error;\n\t\t\t\t} else {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ticketId;\n\t\t},\n\t\t'updateTicket': function (ticketElem) {\n\t\t\tvar updateTicket = TicketMaster.update({\n\t\t\t\t'_id': ticketElem.ticketid\n\t\t\t}, {\n\t\t\t\t$push: {\n\t\t\t\t\tticketElement: {\n\t\t\t\t\t\t'staffId': ticketElem.staffId,\n\t\t\t\t\t\t'staffName': ticketElem.staffname,\n\t\t\t\t\t\t'staffRole': ticketElem.role,\n\t\t\t\t\t\t'roleTicketStatus': [{\n\t\t\t\t\t\t\t'ticketstatus': \"Accepted\",\n\t\t\t\t\t\t\t'createdOn': new Date()\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tMeteor.call('updateOuterStatus', ticketElem);\n\t\t\treturn updateTicket;\n\t\t},\n\t\t'updateOuterStatus': function (ticketElem) {\n\t\t\tTicketMaster.update({\n\t\t\t\t'_id': ticketElem.ticketid\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t\"ticketStatus.0.status\": \"Accepted\"\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t'addDocument': function (currentObj, id, keyValue) {\n\t\t\tconsole.log(\"currentObj :\" + currentObj);\n\t\t\tconsole.log(\"id :\" + id);\n\t\t\tTicketMaster.update({\n\t\t\t\t'userId': id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'ticketElement.permanentAddress': currentObj\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}","map":{"version":3,"sources":["imports/website/ServiceProcess/api/TicketMaster.js"],"names":["module","export","TicketMaster","Mongo","watch","require","v","Meteor","Collection","isServer","publish","find","_id","methods","id","userId","serviceId","serviceName","totalAmount","paymentStatus","delieveryStatus","ticketObj","findOne","sort","createdAt","first","ticketNumber","substr","last","parseInt","length","last0","first2Char","secondAscii","charCodeAt","firstChar","firstAscii","String","fromCharCode","newsecond","ticketId","insert","Date","error","result","ticketElem","updateTicket","update","ticketid","$push","ticketElement","staffId","staffname","role","call","$set","currentObj","keyValue","console","log"],"mappings":"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","file":"imports/website/ServiceProcess/api/TicketMaster.js.map","sourcesContent":["import {Mongo} from 'meteor/mongo';\nimport {Meteor} from 'meteor/meteor';\n\nexport const TicketMaster = new Mongo.Collection(\"ticketMaster\");\n\nif(Meteor.isServer){\n\tMeteor.publish('allTickets',()=>{\n        return TicketMaster.find({});\n\t});\n\tMeteor.publish('singleTicket',(_id)=>{\n        return TicketMaster.find({\"_id\" : _id});\n\t});\n\t\n\tMeteor.methods({\n   \t 'createTicket':function(id,userId,serviceId,serviceName,totalAmount,paymentStatus,delieveryStatus) {\n   \t \t   var ticketObj = TicketMaster.findOne({}, {sort: { createdAt : -1}});\n\t\t\t    if(ticketObj){\n\t\t\t      // var ticketNumber = parseInt(ticketObj.ticketNumber.);\n\t\t\t     //  var last  = parseInt(ticketObj.ticketNumber.substr(ticketObj.ticketNumber.length - 6));\n\t\t\t     //  var first = ticketObj.ticketNumber.substr(0, 1);\n\t\t\t\t    // var ticket = 'AZ099998';\n\t\t\t\t    var first = ticketObj.ticketNumber.substr(0, 2);\n\t\t\t\t    var last  = parseInt(ticketObj.ticketNumber.substr(ticketObj.ticketNumber.length - 6));\n\t\t\t\t\t  last = last + 1;\n\t\t\t\t    var last0 = '0';\n\t\t\t\t    if(last > 0 && last < 11) \n\t\t\t\t    {\n\t\t\t\t    \tlast0 = '00000' + last;\n\t\t\t\t        if(last == 10){last0 = '0000' + last;} /*working*/\n\t\t\t\t    }else if(last > 10 && last < 101){\n\t\t\t\t    \tlast0 = '0000' + last;\n\t\t\t\t        if(last == 100){last0 = '000' + last;}/*working*/\n\t\t\t\t    }else if(last > 100 && last < 1001){\n\t\t\t\t    \tlast0 = '000' + last;\n\t\t\t\t        if(last == 1000){last0 = '00' + last;}/*working*/\n\t\t\t\t    }else if(last > 1000 && last < 10001){\n\t\t\t\t    \tlast0 = '00' + last;\n\t\t\t\t        if(last == 10000){last0 = '0' + last;}/*working*/\n\t\t\t\t    }else if(last > 10000 && last < 100001){\n\t\t\t\t    \tlast0 = '0' + last;\n\t\t\t\t        if(last == 100000){last0 = '000000';}\n\t\t\t\t    }\n\t\t\t\t    if(last >= 100000){\n\t\t\t\t    \tlast0 = '000000';\n\t\t\t\t        var first2Char = first.substr(1,1); /*second digit*/\n\t\t\t\t        var secondAscii = first2Char.charCodeAt(); /*second ascii*/\n\t\t\t\t        var firstChar = first.substr(0,1); /*First char*/\n\t\t\t\t        if(secondAscii == 90){\n\t\t\t\t        \tvar firstAscii = firstChar.charCodeAt() + 1;\n\t\t\t\t          first = String.fromCharCode(firstAscii) + 'A';\n\t\t\t\t        }else {\n\t\t\t\t        \tvar newsecond = secondAscii + 1;\n\t\t\t\t          first = firstChar +''+ String.fromCharCode(newsecond);\n\t\t\t\t        }\n\t\t\t\t        \n\t\t\t\t    }\n\t\t\t\t    var ticketNumber = first+''+last0;\t\t\t   \n\t       }else{\n\t\t\t      var ticketNumber = 'AA000000';\n\t\t\t   }\n\t\t\t   var ticketId  = TicketMaster.insert({\n   \t      \t  \"orderId\"          :   id,\n   \t      \t  \"userId\"           :   userId,\n   \t      \t  \"serviceId\"        :   serviceId,\n              \"serviceName\"      :   serviceName,\n              \"payment\"          :   totalAmount,\n              \"paymentStatus\"    :   paymentStatus,\n              \"ticketNumber\"     :   ticketNumber,\n              \"ticketStatus\"     :  [delieveryStatus],\n              \"createdAt\"        :   new Date(),\n   \t      },(error, result)=>{\n             if (error) {\n                return error;\n             }else{\n             \t return result;\n             }\n          });\n\t\t\t  return ticketId;\n\t\t},    \n\t\t\n\n\t\t'updateTicket':function(ticketElem){\n\t\t\tvar updateTicket = TicketMaster.update(\n\t\t\t\t{'_id':ticketElem.ticketid},\n\t\t\t\t{$push:{\n\t\t\t\t\t\tticketElement:{\n\t\t\t\t\t\t'staffId'  : ticketElem.staffId,\n\t\t\t\t\t\t'staffName': ticketElem.staffname,\n\t\t\t\t\t\t'staffRole': ticketElem.role,\n\t\t\t\t\t\t'roleTicketStatus':[{\n\t\t\t\t\t\t\t'ticketstatus':\"Accepted\",\n\t\t\t\t\t\t\t'createdOn'   : new Date(),\n\t\t\t\t\t\t}]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\tMeteor.call('updateOuterStatus',ticketElem);\n\t\t\treturn updateTicket;\n\t\t\t\n\t\t},\n\n\t\t'updateOuterStatus':function(ticketElem){\n\t\t\tTicketMaster.update(\n\t\t\t{'_id':ticketElem.ticketid},\n\t\t\t{   $set:{\n\t\t\t\t\t\"ticketStatus.0.status\":\"Accepted\",\n\t\t\t\t}\n\t\t\t}\n\t\t\t)\n\t\t\t\n\t\t},\n\t\t'addDocument':function(currentObj,id,keyValue){\n\t\t\tconsole.log(\"currentObj :\"+currentObj);\n\t\t\tconsole.log(\"id :\"+id);\t\n\t\t\tTicketMaster.update(\n\t\t\t\t{'userId':id},\n\t\t\t\t\t{   $set:{\n\t\t\t\t\t\t\t'ticketElement.permanentAddress':currentObj\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t)\n\t\t}\n\t\n\t  });\n\n\n}"]},"hash":"c4a9b5b9eaf2fd72a41aaa9078a01df7807a3a8b"}
