{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"meteor/underscore","imported":["_"],"specifiers":[{"kind":"named","imported":"_","local":"_"}]},{"source":"meteor/mongo","imported":["Mongo"],"specifiers":[{"kind":"named","imported":"Mongo","local":"Mongo"}]},{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/ostrio:cookies","imported":["Cookies"],"specifiers":[{"kind":"named","imported":"Cookies","local":"Cookies"}]},{"source":"./lib.js","imported":["formatFleURL"],"specifiers":[{"kind":"named","imported":"formatFleURL","local":"formatFleURL"}]},{"source":"meteor/check","imported":["check","Match"],"specifiers":[{"kind":"named","imported":"check","local":"check"},{"kind":"named","imported":"Match","local":"Match"}]},{"source":"./upload.js","imported":["UploadInstance"],"specifiers":[{"kind":"named","imported":"UploadInstance","local":"UploadInstance"}]},{"source":"./core.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"FilesCollectionCore"}]}],"exports":{"exported":["FilesCollection"],"specifiers":[{"kind":"local","local":"FilesCollection","exported":"FilesCollection"}]}}},"options":{"filename":"packages/ostrio:files/client.js","filenameRelative":"packages/ostrio:files/client.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"packages/ostrio:files/client.js.map","sourceFileName":"packages/ostrio:files/client.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"client"},"ignored":false,"code":"var _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nmodule.export({\n  FilesCollection: function () {\n    return FilesCollection;\n  }\n});\n\nvar _ = void 0;\n\nmodule.watch(require(\"meteor/underscore\"), {\n  _: function (v) {\n    _ = v;\n  }\n}, 0);\nvar Mongo = void 0;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo: function (v) {\n    Mongo = v;\n  }\n}, 1);\nvar Meteor = void 0;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar Cookies = void 0;\nmodule.watch(require(\"meteor/ostrio:cookies\"), {\n  Cookies: function (v) {\n    Cookies = v;\n  }\n}, 3);\nvar formatFleURL = void 0;\nmodule.watch(require(\"./lib.js\"), {\n  formatFleURL: function (v) {\n    formatFleURL = v;\n  }\n}, 4);\nvar check = void 0,\n    Match = void 0;\nmodule.watch(require(\"meteor/check\"), {\n  check: function (v) {\n    check = v;\n  },\n  Match: function (v) {\n    Match = v;\n  }\n}, 5);\nvar UploadInstance = void 0;\nmodule.watch(require(\"./upload.js\"), {\n  UploadInstance: function (v) {\n    UploadInstance = v;\n  }\n}, 6);\nvar FilesCollectionCore = void 0;\nmodule.watch(require(\"./core.js\"), {\n  \"default\": function (v) {\n    FilesCollectionCore = v;\n  }\n}, 7);\n\nvar NOOP = function () {}; /*\n                            * @locus Anywhere\n                            * @class FilesCollection\n                            * @param config           {Object}   - [Both]   Configuration object with next properties:\n                            * @param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n                            * @param config.ddp       {Object}   - [Client] Custom DDP connection. Object returned form `DDP.connect()`\n                            * @param config.schema    {Object}   - [Both]   Collection Schema\n                            * @param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs`\n                            * @param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n                            * @param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n                            * @param config.collection     {Mongo.Collection} - [Both] Mongo Collection Instance\n                            * @param config.collectionName {String}  - [Both]   Collection name\n                            * @param config.namingFunction {Function}- [Both]   Function which returns `String`\n                            * @param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\n                            * return `true` to continue\n                            * return `false` or `String` to abort upload\n                            * @param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n                            * @param config.onbeforeunloadMessage {String|Function} - [Client] Message shown to user when closing browser's window or tab while upload process is running\n                            * @param config.disableUpload {Boolean} - Disable file upload, useful for server only solutions\n                            * @summary Create new instance of FilesCollection\n                            */\n\nvar FilesCollection = function (_FilesCollectionCore) {\n  (0, _inherits3.default)(FilesCollection, _FilesCollectionCore);\n\n  function FilesCollection(config) {\n    (0, _classCallCheck3.default)(this, FilesCollection);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, _FilesCollectionCore.call(this));\n\n    if (config) {\n      _this.ddp = config.ddp;\n      _this.debug = config.debug;\n      _this.schema = config.schema;\n      _this.public = config.public;\n      _this.chunkSize = config.chunkSize;\n      _this.collection = config.collection;\n      _this.downloadRoute = config.downloadRoute;\n      _this.disableUpload = config.disableUpload;\n      _this.namingFunction = config.namingFunction;\n      _this.collectionName = config.collectionName;\n      _this.onBeforeUpload = config.onBeforeUpload;\n      _this.allowClientCode = config.allowClientCode;\n      _this.onbeforeunloadMessage = config.onbeforeunloadMessage;\n    }\n\n    var self = _this;\n    var cookie = new Cookies();\n\n    if (!_.isBoolean(_this.debug)) {\n      _this.debug = false;\n    }\n\n    if (!_.isBoolean(_this.public)) {\n      _this.public = false;\n    }\n\n    if (!_this.chunkSize) {\n      _this.chunkSize = 1024 * 512;\n    }\n\n    _this.chunkSize = Math.floor(_this.chunkSize / 8) * 8;\n\n    if (!_.isString(_this.collectionName) && !_this.collection) {\n      _this.collectionName = 'MeteorUploadFiles';\n    }\n\n    if (!_this.collection) {\n      _this.collection = new Mongo.Collection(_this.collectionName);\n    } else {\n      _this.collectionName = _this.collection._name;\n    }\n\n    _this.collection.filesCollection = _this;\n    check(_this.collectionName, String);\n\n    if (_this.public && !_this.downloadRoute) {\n      throw new Meteor.Error(500, \"[FilesCollection.\" + _this.collectionName + \"]: \\\"downloadRoute\\\" must be precisely provided on \\\"public\\\" collections! Note: \\\"downloadRoute\\\" must be equal or be inside of your web/proxy-server (relative) root.\");\n    }\n\n    if (!_.isBoolean(_this.disableUpload)) {\n      _this.disableUpload = false;\n    }\n\n    if (!_.isString(_this.downloadRoute)) {\n      _this.downloadRoute = '/cdn/storage';\n    }\n\n    _this.downloadRoute = _this.downloadRoute.replace(/\\/$/, '');\n\n    if (!_.isFunction(_this.namingFunction)) {\n      _this.namingFunction = false;\n    }\n\n    if (!_.isFunction(_this.onBeforeUpload)) {\n      _this.onBeforeUpload = false;\n    }\n\n    if (!_.isBoolean(_this.allowClientCode)) {\n      _this.allowClientCode = true;\n    }\n\n    if (!_this.ddp) {\n      _this.ddp = Meteor;\n    }\n\n    if (!_this.onbeforeunloadMessage) {\n      _this.onbeforeunloadMessage = 'Upload in a progress... Do you want to abort?';\n    }\n\n    var setTokenCookie = function () {\n      if (!cookie.has('x_mtok') && Meteor.connection._lastSessionId || cookie.has('x_mtok') && cookie.get('x_mtok') !== Meteor.connection._lastSessionId) {\n        cookie.set('x_mtok', Meteor.connection._lastSessionId, {\n          path: '/'\n        });\n      }\n    };\n\n    var unsetTokenCookie = function () {\n      if (cookie.has('x_mtok')) {\n        cookie.remove('x_mtok', '/');\n      }\n    };\n\n    if (typeof Accounts !== 'undefined' && Accounts !== null) {\n      Meteor.startup(function () {\n        setTokenCookie();\n      });\n      Accounts.onLogin(function () {\n        setTokenCookie();\n      });\n      Accounts.onLogout(function () {\n        unsetTokenCookie();\n      });\n    }\n\n    check(_this.onbeforeunloadMessage, Match.OneOf(String, Function));\n\n    try {\n      var _URL = window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL || false;\n\n      if (window.Worker && window.Blob && _URL) {\n        _this._supportWebWorker = true;\n        _this._webWorkerUrl = _URL.createObjectURL(new Blob(['!function(a){\"use strict\";a.onmessage=function(b){var c=b.data.f.slice(b.data.cs*(b.data.cc-1),b.data.cs*b.data.cc);if(b.data.ib===!0)postMessage({bin:c,chunkId:b.data.cc});else{var d;a.FileReader?(d=new FileReader,d.onloadend=function(a){postMessage({bin:(d.result||a.srcElement||a.target).split(\",\")[1],chunkId:b.data.cc,s:b.data.s})},d.onerror=function(a){throw(a.target||a.srcElement).error},d.readAsDataURL(c)):a.FileReaderSync?(d=new FileReaderSync,postMessage({bin:d.readAsDataURL(c).split(\",\")[1],chunkId:b.data.cc})):postMessage({bin:null,chunkId:b.data.cc,error:\"File API is not supported in WebWorker!\"})}}}(this);'], {\n          type: 'application/javascript'\n        }));\n      } else if (window.Worker) {\n        _this._supportWebWorker = true;\n        _this._webWorkerUrl = Meteor.absoluteUrl('packages/ostrio_files/worker.min.js');\n      } else {\n        _this._supportWebWorker = false;\n      }\n    } catch (e) {\n      self._debug('[FilesCollection] [Check WebWorker Availability] Error:', e);\n\n      _this._supportWebWorker = false;\n    }\n\n    if (!_this.schema) {\n      _this.schema = FilesCollectionCore.schema;\n    }\n\n    check(_this.debug, Boolean);\n    check(_this.schema, Object);\n    check(_this.public, Boolean);\n    check(_this.chunkSize, Number);\n    check(_this.downloadRoute, String);\n    check(_this.disableUpload, Boolean);\n    check(_this.namingFunction, Match.OneOf(false, Function));\n    check(_this.onBeforeUpload, Match.OneOf(false, Function));\n    check(_this.allowClientCode, Boolean);\n    check(_this.ddp, Match.Any);\n    _this._methodNames = {\n      _Abort: \"_FilesCollectionAbort_\" + _this.collectionName,\n      _Write: \"_FilesCollectionWrite_\" + _this.collectionName,\n      _Start: \"_FilesCollectionStart_\" + _this.collectionName,\n      _Remove: \"_FilesCollectionRemove_\" + _this.collectionName\n    };\n    return _this;\n  } /*\n     * @locus Anywhere\n     * @memberOf FilesCollection\n     * @name _getMimeType\n     * @param {Object} fileData - File Object\n     * @summary Returns file's mime-type\n     * @returns {String}\n     */\n\n  FilesCollection.prototype._getMimeType = function () {\n    function _getMimeType(fileData) {\n      var mime = void 0;\n      check(fileData, Object);\n\n      if (_.isObject(fileData)) {\n        mime = fileData.type;\n      }\n\n      if (!mime || !_.isString(mime)) {\n        mime = 'application/octet-stream';\n      }\n\n      return mime;\n    }\n\n    return _getMimeType;\n  }(); /*\n        * @locus Anywhere\n        * @memberOf FilesCollection\n        * @name _getUser\n        * @summary Returns object with `userId` and `user()` method which return user's object\n        * @returns {Object}\n        */\n\n  FilesCollection.prototype._getUser = function () {\n    function _getUser() {\n      var result = {\n        user: function () {\n          return null;\n        },\n        userId: null\n      };\n\n      if (_.isFunction(Meteor.userId)) {\n        result.user = function () {\n          return Meteor.user();\n        };\n\n        result.userId = Meteor.userId();\n      }\n\n      return result;\n    }\n\n    return _getUser;\n  }(); /*\n        * @locus Client\n        * @memberOf FilesCollection\n        * @name insert\n        * @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n        * @param {Object} config - Configuration object with next properties:\n        *   {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n        *   {Object}      meta           - Additional data as object, use later for search\n        *   {Boolean}     allowWebWorkers- Allow/Deny WebWorkers usage\n        *   {Number|dynamic} streams     - Quantity of parallel upload streams, default: 2\n        *   {Number|dynamic} chunkSize   - Chunk size for upload\n        *   {String}      transport      - Upload transport `http` or `ddp`\n        *   {Object}      ddp            - Custom DDP connection. Object returned form `DDP.connect()`\n        *   {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n        *   {Function}    onStart        - Callback triggered when upload is started after all successful validations, with two arguments `error` (always null) and `fileRef`\n        *   {Function}    onError        - Callback triggered on error in upload and/or FileReader, with two arguments `error` and `fileData`\n        *   {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n        *   {Function}    onBeforeUpload - Callback triggered right before upload is started:\n        *       return true to continue\n        *       return false to abort upload\n        * @param {Boolean} autoStart     - Start upload immediately. If set to false, you need manually call .start() method on returned class. Useful to set EventListeners.\n        * @summary Upload file to server over DDP or HTTP\n        * @returns {UploadInstance} Instance. UploadInstance has next properties:\n        *   {ReactiveVar} onPause  - Is upload process on the pause?\n        *   {ReactiveVar} state    - active|paused|aborted|completed\n        *   {ReactiveVar} progress - Current progress in percentage\n        *   {Function}    pause    - Pause upload process\n        *   {Function}    continue - Continue paused upload process\n        *   {Function}    toggle   - Toggle continue/pause if upload process\n        *   {Function}    abort    - Abort upload\n        *   {Function}    readAsDataURL - Current file as data URL, use to create image preview and etc. Be aware of big files, may lead to browser crash\n        */\n\n  FilesCollection.prototype.insert = function () {\n    function insert(config) {\n      var autoStart = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n      if (this.disableUpload) {\n        console.warn('[FilesCollection] [insert()] Upload is disabled with [disableUpload]!');\n        return {};\n      }\n\n      return new UploadInstance(config, this)[autoStart ? 'start' : 'manual']();\n    }\n\n    return insert;\n  }(); /*\n        * @locus Anywhere\n        * @memberOf FilesCollection\n        * @name remove\n        * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n        * @param {Function} callback - Callback with one `error` argument\n        * @summary Remove documents from the collection\n        * @returns {FilesCollection} Instance\n        */\n\n  FilesCollection.prototype.remove = function () {\n    function remove() {\n      var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var callback = arguments[1];\n\n      this._debug(\"[FilesCollection] [remove(\" + JSON.stringify(selector) + \")]\");\n\n      check(selector, Match.OneOf(Object, String));\n      check(callback, Match.Optional(Function));\n\n      if (this.allowClientCode) {\n        this.ddp.call(this._methodNames._Remove, selector, callback || NOOP);\n      } else {\n        callback && callback(new Meteor.Error(401, '[FilesCollection] [remove] Run code from client is not allowed!'));\n\n        this._debug('[FilesCollection] [remove] Run code from client is not allowed!');\n      }\n\n      return this;\n    }\n\n    return remove;\n  }();\n\n  return FilesCollection;\n}(FilesCollectionCore);\n\n/*\n * @locus Client\n * @TemplateHelper\n * @name fileURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like to request\n * @summary Get download URL for file by fileRef, even without subscription\n * @example {{fileURL fileRef}}\n * @returns {String}\n */Meteor.startup(function () {\n  if (typeof Template !== 'undefined' && Template !== null) {\n    Template.registerHelper('fileURL', function (fileRef) {\n      var version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'original';\n\n      if (!_.isObject(fileRef)) {\n        return '';\n      }\n\n      version = !_.isString(version) ? 'original' : version;\n      return formatFleURL(fileRef, version);\n    });\n  }\n});","map":{"version":3,"sources":["packages/ostrio:files/client.js"],"names":["module","export","FilesCollection","_","watch","require","v","Mongo","Meteor","Cookies","formatFleURL","check","Match","UploadInstance","FilesCollectionCore","NOOP","config","ddp","debug","schema","public","chunkSize","collection","downloadRoute","disableUpload","namingFunction","collectionName","onBeforeUpload","allowClientCode","onbeforeunloadMessage","self","cookie","isBoolean","Math","floor","isString","Collection","_name","filesCollection","String","Error","replace","isFunction","setTokenCookie","has","connection","_lastSessionId","get","set","path","unsetTokenCookie","remove","Accounts","startup","onLogin","onLogout","OneOf","Function","_URL","window","URL","webkitURL","mozURL","msURL","oURL","Worker","Blob","_supportWebWorker","_webWorkerUrl","createObjectURL","type","absoluteUrl","e","_debug","Boolean","Object","Number","Any","_methodNames","_Abort","_Write","_Start","_Remove","_getMimeType","fileData","mime","isObject","_getUser","result","user","userId","insert","autoStart","console","warn","selector","callback","JSON","stringify","Optional","call","Template","registerHelper","fileRef","version"],"mappings":"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","file":"packages/ostrio:files/client.js.map","sourcesContent":["import { _ }               from 'meteor/underscore';\nimport { Mongo }           from 'meteor/mongo';\nimport { Meteor }          from 'meteor/meteor';\nimport { Cookies }         from 'meteor/ostrio:cookies';\nimport { formatFleURL }    from './lib.js';\nimport { check, Match }    from 'meteor/check';\nimport { UploadInstance }  from './upload.js';\nimport FilesCollectionCore from './core.js';\n\nconst NOOP = () => { };\n\n/*\n * @locus Anywhere\n * @class FilesCollection\n * @param config           {Object}   - [Both]   Configuration object with next properties:\n * @param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n * @param config.ddp       {Object}   - [Client] Custom DDP connection. Object returned form `DDP.connect()`\n * @param config.schema    {Object}   - [Both]   Collection Schema\n * @param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs`\n * @param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n * @param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n * @param config.collection     {Mongo.Collection} - [Both] Mongo Collection Instance\n * @param config.collectionName {String}  - [Both]   Collection name\n * @param config.namingFunction {Function}- [Both]   Function which returns `String`\n * @param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\n * return `true` to continue\n * return `false` or `String` to abort upload\n * @param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n * @param config.onbeforeunloadMessage {String|Function} - [Client] Message shown to user when closing browser's window or tab while upload process is running\n * @param config.disableUpload {Boolean} - Disable file upload, useful for server only solutions\n * @summary Create new instance of FilesCollection\n */\nexport class FilesCollection extends FilesCollectionCore {\n  constructor(config) {\n    super();\n    if (config) {\n      ({\n        ddp: this.ddp,\n        debug: this.debug,\n        schema: this.schema,\n        public: this.public,\n        chunkSize: this.chunkSize,\n        collection: this.collection,\n        downloadRoute: this.downloadRoute,\n        disableUpload: this.disableUpload,\n        namingFunction: this.namingFunction,\n        collectionName: this.collectionName,\n        onBeforeUpload: this.onBeforeUpload,\n        allowClientCode: this.allowClientCode,\n        onbeforeunloadMessage: this.onbeforeunloadMessage,\n      } = config);\n    }\n\n    const self = this;\n    const cookie = new Cookies();\n    if (!_.isBoolean(this.debug)) {\n      this.debug = false;\n    }\n\n    if (!_.isBoolean(this.public)) {\n      this.public = false;\n    }\n\n    if (!this.chunkSize) {\n      this.chunkSize = 1024 * 512;\n    }\n    this.chunkSize = Math.floor(this.chunkSize / 8) * 8;\n\n    if (!_.isString(this.collectionName) && !this.collection) {\n      this.collectionName = 'MeteorUploadFiles';\n    }\n\n    if (!this.collection) {\n      this.collection = new Mongo.Collection(this.collectionName);\n    } else {\n      this.collectionName = this.collection._name;\n    }\n\n    this.collection.filesCollection = this;\n    check(this.collectionName, String);\n\n    if (this.public && !this.downloadRoute) {\n      throw new Meteor.Error(500, `[FilesCollection.${this.collectionName}]: \\\"downloadRoute\\\" must be precisely provided on \\\"public\\\" collections! Note: \\\"downloadRoute\\\" must be equal or be inside of your web/proxy-server (relative) root.`);\n    }\n\n    if (!_.isBoolean(this.disableUpload)) {\n      this.disableUpload = false;\n    }\n\n    if (!_.isString(this.downloadRoute)) {\n      this.downloadRoute = '/cdn/storage';\n    }\n\n    this.downloadRoute = this.downloadRoute.replace(/\\/$/, '');\n\n    if (!_.isFunction(this.namingFunction)) {\n      this.namingFunction = false;\n    }\n\n    if (!_.isFunction(this.onBeforeUpload)) {\n      this.onBeforeUpload = false;\n    }\n\n    if (!_.isBoolean(this.allowClientCode)) {\n      this.allowClientCode = true;\n    }\n\n    if (!this.ddp) {\n      this.ddp = Meteor;\n    }\n\n    if (!this.onbeforeunloadMessage) {\n      this.onbeforeunloadMessage = 'Upload in a progress... Do you want to abort?';\n    }\n\n    const setTokenCookie = () => {\n      if ((!cookie.has('x_mtok') && Meteor.connection._lastSessionId) || (cookie.has('x_mtok') && (cookie.get('x_mtok') !== Meteor.connection._lastSessionId))) {\n        cookie.set('x_mtok', Meteor.connection._lastSessionId, {\n          path: '/'\n        });\n      }\n    };\n\n    const unsetTokenCookie = () => {\n      if (cookie.has('x_mtok')) {\n        cookie.remove('x_mtok', '/');\n      }\n    };\n\n    if (typeof Accounts !== 'undefined' && Accounts !== null) {\n      Meteor.startup(() => {\n        setTokenCookie();\n      });\n      Accounts.onLogin(() => {\n        setTokenCookie();\n      });\n      Accounts.onLogout(() => {\n        unsetTokenCookie();\n      });\n    }\n\n    check(this.onbeforeunloadMessage, Match.OneOf(String, Function));\n\n    try {\n      const _URL = window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL || false;\n      if (window.Worker && window.Blob && _URL) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl     = _URL.createObjectURL(new Blob(['!function(a){\"use strict\";a.onmessage=function(b){var c=b.data.f.slice(b.data.cs*(b.data.cc-1),b.data.cs*b.data.cc);if(b.data.ib===!0)postMessage({bin:c,chunkId:b.data.cc});else{var d;a.FileReader?(d=new FileReader,d.onloadend=function(a){postMessage({bin:(d.result||a.srcElement||a.target).split(\",\")[1],chunkId:b.data.cc,s:b.data.s})},d.onerror=function(a){throw(a.target||a.srcElement).error},d.readAsDataURL(c)):a.FileReaderSync?(d=new FileReaderSync,postMessage({bin:d.readAsDataURL(c).split(\",\")[1],chunkId:b.data.cc})):postMessage({bin:null,chunkId:b.data.cc,error:\"File API is not supported in WebWorker!\"})}}}(this);'], {type: 'application/javascript'}));\n      } else if (window.Worker) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl     = Meteor.absoluteUrl('packages/ostrio_files/worker.min.js');\n      } else {\n        this._supportWebWorker = false;\n      }\n    } catch (e) {\n      self._debug('[FilesCollection] [Check WebWorker Availability] Error:', e);\n      this._supportWebWorker = false;\n    }\n\n    if (!this.schema) {\n      this.schema = FilesCollectionCore.schema;\n    }\n\n    check(this.debug, Boolean);\n    check(this.schema, Object);\n    check(this.public, Boolean);\n    check(this.chunkSize, Number);\n    check(this.downloadRoute, String);\n    check(this.disableUpload, Boolean);\n    check(this.namingFunction, Match.OneOf(false, Function));\n    check(this.onBeforeUpload, Match.OneOf(false, Function));\n    check(this.allowClientCode, Boolean);\n    check(this.ddp, Match.Any);\n\n    this._methodNames = {\n      _Abort: `_FilesCollectionAbort_${this.collectionName}`,\n      _Write: `_FilesCollectionWrite_${this.collectionName}`,\n      _Start: `_FilesCollectionStart_${this.collectionName}`,\n      _Remove: `_FilesCollectionRemove_${this.collectionName}`\n    };\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getMimeType\n   * @param {Object} fileData - File Object\n   * @summary Returns file's mime-type\n   * @returns {String}\n   */\n  _getMimeType(fileData) {\n    let mime;\n    check(fileData, Object);\n    if (_.isObject(fileData)) {\n      mime = fileData.type;\n    }\n\n    if (!mime || !_.isString(mime)) {\n      mime = 'application/octet-stream';\n    }\n    return mime;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUser\n   * @summary Returns object with `userId` and `user()` method which return user's object\n   * @returns {Object}\n   */\n  _getUser() {\n    const result = {\n      user() {\n        return null;\n      },\n      userId: null\n    };\n\n    if (_.isFunction(Meteor.userId)) {\n      result.user = () => Meteor.user();\n      result.userId = Meteor.userId();\n    }\n\n    return result;\n  }\n\n  /*\n   * @locus Client\n   * @memberOf FilesCollection\n   * @name insert\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n   * @param {Object} config - Configuration object with next properties:\n   *   {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n   *   {Object}      meta           - Additional data as object, use later for search\n   *   {Boolean}     allowWebWorkers- Allow/Deny WebWorkers usage\n   *   {Number|dynamic} streams     - Quantity of parallel upload streams, default: 2\n   *   {Number|dynamic} chunkSize   - Chunk size for upload\n   *   {String}      transport      - Upload transport `http` or `ddp`\n   *   {Object}      ddp            - Custom DDP connection. Object returned form `DDP.connect()`\n   *   {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n   *   {Function}    onStart        - Callback triggered when upload is started after all successful validations, with two arguments `error` (always null) and `fileRef`\n   *   {Function}    onError        - Callback triggered on error in upload and/or FileReader, with two arguments `error` and `fileData`\n   *   {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n   *   {Function}    onBeforeUpload - Callback triggered right before upload is started:\n   *       return true to continue\n   *       return false to abort upload\n   * @param {Boolean} autoStart     - Start upload immediately. If set to false, you need manually call .start() method on returned class. Useful to set EventListeners.\n   * @summary Upload file to server over DDP or HTTP\n   * @returns {UploadInstance} Instance. UploadInstance has next properties:\n   *   {ReactiveVar} onPause  - Is upload process on the pause?\n   *   {ReactiveVar} state    - active|paused|aborted|completed\n   *   {ReactiveVar} progress - Current progress in percentage\n   *   {Function}    pause    - Pause upload process\n   *   {Function}    continue - Continue paused upload process\n   *   {Function}    toggle   - Toggle continue/pause if upload process\n   *   {Function}    abort    - Abort upload\n   *   {Function}    readAsDataURL - Current file as data URL, use to create image preview and etc. Be aware of big files, may lead to browser crash\n   */\n  insert(config, autoStart = true) {\n    if (this.disableUpload) {\n      console.warn('[FilesCollection] [insert()] Upload is disabled with [disableUpload]!');\n      return {};\n    }\n    return (new UploadInstance(config, this))[autoStart ? 'start' : 'manual']();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name remove\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Function} callback - Callback with one `error` argument\n   * @summary Remove documents from the collection\n   * @returns {FilesCollection} Instance\n   */\n  remove(selector = {}, callback) {\n    this._debug(`[FilesCollection] [remove(${JSON.stringify(selector)})]`);\n    check(selector, Match.OneOf(Object, String));\n    check(callback, Match.Optional(Function));\n\n    if (this.allowClientCode) {\n      this.ddp.call(this._methodNames._Remove, selector, (callback || NOOP));\n    } else {\n      callback && callback(new Meteor.Error(401, '[FilesCollection] [remove] Run code from client is not allowed!'));\n      this._debug('[FilesCollection] [remove] Run code from client is not allowed!');\n    }\n\n    return this;\n  }\n}\n\n/*\n * @locus Client\n * @TemplateHelper\n * @name fileURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like to request\n * @summary Get download URL for file by fileRef, even without subscription\n * @example {{fileURL fileRef}}\n * @returns {String}\n */\nMeteor.startup(() => {\n  if (typeof Template !== 'undefined' && Template !== null) {\n    Template.registerHelper('fileURL', (fileRef, version = 'original') => {\n      if (!_.isObject(fileRef)) {\n        return '';\n      }\n\n      version = (!_.isString(version)) ? 'original' : version;\n      return formatFleURL(fileRef, version);\n    });\n  }\n});\n"]},"hash":"c0b0fbec46f40115bef2fd29d297e788f755fac3"}
